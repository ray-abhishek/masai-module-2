<!DOCTYPE html>
<html>
    <head>
        <title>Covid19 Tracker</title>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    </head>
    <style type="text/css">
        @import url('./base.css');

    </style>
    <body>
        <div class="container text-center">
            <h1>Track Covid-19 Across Countries</h1>
            <form id="form-data">
            <div class="row mt-5">
                <div class="col-xs-12 col-sm-4 col-md-4">
                    <input type="text" class="form-control" name="Country1" id="country1">
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4">
                    <input type="text" class="form-control" name="Country2" id="country2">
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4">
                    <button type="submit" class="btn btn-warning">Track</button>
                </div>
                
            </div>
            </form>
            <div class="card mt-5 pt-5" id="chart-container">
                <canvas id="canvas"></canvas>
                    
            </div>
        </div>
    </body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
    <script type="text/javascript">

        

        window.addEventListener('load',()=>{
            var form = document.getElementById('form-data')
            form.addEventListener('submit',(event)=>{
                event.preventDefault()
                var c1 = document.getElementById('country1')
                var c2 = document.getElementById('country2')
                fetchData(c1.value, c2.value)
            })
        })

        const fetchData = async (c1, c2)=>{
         //   var i = 1;
            var dataPoints1 = []
            var dateLabel1 = []
            var dataPoints2 = []
            var dateLabel2 = []
            let url = 'https://api.covid19api.com/total/dayone/country/'

            await fetch(url+c1+'/status/confirmed')
                    .then(res=>res.json())
                    .then(res=>{
                        console.log(res, " is ",c1)
                        res.forEach((item)=>{
                        let dateInCorrectFormat = formatDate(item.Date)
                        dataPoints1.push({x:dateInCorrectFormat, y: Number(item.Cases)})
                        dateLabel1.push(dateInCorrectFormat) 
                    })
                    })

            await fetch(url+c2+'/status/confirmed')
                    .then(res=>res.json())
                    .then(res=>{
                        console.log(res, " is ",c2)
                        res.forEach((item)=>{
                        let dateInCorrectFormat = formatDate(item.Date)
                        dataPoints2.push({x:dateInCorrectFormat, y: Number(item.Cases)})
                        dateLabel2.push(dateInCorrectFormat) 
                    })
                    })
                
            await console.log(country1, " data is ", dataPoints1)
            await console.log(country2, " data is ", dataPoints2)
        //    await console.log(dateLabel1, " is dateLabel1")
       //     await console.log(dateLabel2, " is dateLabel2")
            await drawGraph(dataPoints1, dateLabel1, dataPoints2, dateLabel2, c1, c2)
        }

        const drawGraph = (dataPoints1, dateLabel1, dataPoints2, dateLabel2, country1, country2)=>{

         //   console.log(country1, " data is ", dataPoints1)
         //   console.log(country2, " data is ", dataPoints2)
            let config = {
                type : 'line',
                data : {
                    labels:  dateLabel1.length>dateLabel2.length?dateLabel1:dateLabel2 ,
                    datasets: [{
                        label: country1,
                        backgroundColor:'rgb(255,0,0)',
                        borderColor: 'rgb(255,0,0)',
                        data: dataPoints1,
                        fill: false,
                        pointHoverBackgroundColor: 'rgb(139,0,0)',
                        pointHoverRadius: 6,
                        pointRotation: 30
                    },{
                        label: country2,
                        backgroundColor: 'rgb(0,0,255)',
                        borderColor: 'rgb(0,0,255)',
                        data: dataPoints2,
                        fill: false,
                        pointHoverBackgroundColor: 'rgb(75,0,130)',
                        pointHoverRadius: 6,
                        pointRotation: 30
                    }]
                },
                options: {
				    responsive: true,
				    title: {
				    	display: true,
				    	text: 'Covid 19 Cases'
				    },
				    tooltips: {
                        mode: 'x',
                        backgroundColor: 'rgb(0,128,0)',
                    //	intersect: false,
                        titleFontSize: 18,
                        bodyFontSize: 16,
                    },
				    hover: {
				    	mode: 'nearest',
				    	intersect: true
				    },    
				    scales: {
                        xAxes: [{
                            type : 'time',
                            distribution: 'series',
                            ticks: {
                                fontSize: 20,
                            }
                        }],
				    	yAxes: [{
				    		display: true,
				    		scaleLabel: {
				    			display: true,
				    			labelString: 'CASES'
                            },
                            ticks: {
                                fontSize: 20,
                            }
				    	        }]
                    },
			    }
            }
            var ctx = document.getElementById('canvas').getContext('2d');
            ctx.clearRect(0,0, canvas.width, canvas.height)
			window.myLine = new Chart(ctx, config);
        }

        const formatDate = (dateInWrongFormat)=>
        {
            var lastPos = dateInWrongFormat.lastIndexOf('-')
            let day = dateInWrongFormat.substr(lastPos+1, 2)
            var firstPos = dateInWrongFormat.indexOf('-')
            let month = dateInWrongFormat.substr(firstPos+1, 2)
            let year = dateInWrongFormat.substr(0,4)
        //    console.log("year ",year," month ",month, " day ",day)
            return new Date(year, month-1, day)
        }


    </script>
</html>